---
title: Preprocessing data
author: Sebastian Robledo
date: "Nov 20, 2022"
format:
    html:   
        code-fold: true
---

The data is in this link
https://drive.google.com/drive/u/1/folders/121mO0RrDahIkjP4-bp6Os8fvI_DJhOtp

```{python}
import pandas as pd
import gdown
# run file from the root of the project called "groups_preprocessing.py"
%run cluster_preprocessing.py
```

# Preprocessing Groups
```{python}
# create a variable called "groups_raw" from the url "https://drive.google.com/file/d/1Ath8osa-9K4jDhrP5_qZ78AT5UwV79hC/view?usp=share_link""
groups_url = "https://drive.google.com/file/d/1S5Hdhx4aL2MbtxKF6h1TbYd3lg3WZA7j/view?usp=share_link"
groups_url = 'https://drive.google.com/uc?id=' + groups_url.split('/')[-2]
groups_raw = pd.read_csv(groups_url, encoding='utf-8')
# Run the function "preprocess_groups" on the variable "groups_raw"
institution_groups = preprocessing_groups_institutions(groups_raw)
del groups_url
```

# Preprocessing chapters

```{python}
# create a variable called "capitulos_raw" from the url "https://drive.google.com/file/d/1YhtuesiVtpOTtZP9p1noZ-eOfcLuc_3G/view?usp=share_link"
capitulos_url = "https://drive.google.com/file/d/1YhtuesiVtpOTtZP9p1noZ-eOfcLuc_3G/view?usp=share_link"
capitulos_url = 'https://drive.google.com/uc?id=' + capitulos_url.split('/')[-2]
capitulos_raw = pd.read_csv(capitulos_url, sep=';')
del capitulos_url
institution_chapters = preprocessing_groups_capitulos(groups_raw, capitulos_raw)
```

# Preprocessing products

## Papers

```{python}
papers_url = "https://drive.google.com/file/d/1kUZtJz_tJkKzhwtHcRWjHfbYv_3wTZUK/view?usp=share_link"
papers_url = 'https://drive.google.com/uc?id=' + papers_url.split('/')[-2]
output = "articulos_publindex_scimago.csv"
gdown.download(papers_url, output, quiet=False)
papers_raw = pd.read_csv('articulos_publindex_scimago.csv', sep=";")
institution_papers = preprocessing_groups_papers(papers_raw, groups_raw)
del papers_url
del output 
```

# Preprocessing researchers

```{python}
# create a variable called "researchers_raw" from the url "https://drive.google.com/file/d/1FVOasDcWgGBX41_6mGyt3LudneR29hfj/view?usp=sharing"
researchers_url = "https://drive.google.com/file/d/1FVOasDcWgGBX41_6mGyt3LudneR29hfj/view?usp=share_link"
researchers_url = 'https://drive.google.com/uc?id=' + researchers_url.split('/')[-2]
researchers_raw = pd.read_csv(researchers_url, sep=';')
del researchers_url
institution_researcher = preprocessing_groups_researchers(researchers_raw, groups_raw)
```

# Merging all datasets

```{python}
# Merge the dataframes "institution_groups", "institution_papers", "institutions_chapters" and "institution_researcher" in a dataframe called "institution_data" using the column "instituciones"    
institution_data = pd.merge(institution_groups, institution_papers, on='instituciones', how='outer')
institution_data = pd.merge(institution_data, institution_chapters, on='instituciones', how='outer')
institution_data = pd.merge(institution_data, institution_researcher, on='instituciones', how='outer')
```

